[chasedown]
timespan = 24 hours ago
hosts = .js.
metrics = [
    'system.cpu.idle',
    'ex_workers.crawler_nodes.bing',
    'papi.queue.web_insight',
    'proper.redis.requeue.standard.google',
    'redis.net.clients',
    ] + ['workers.us.google.status.{}'.format(i) for i in [900, 901, 902, 903, 904, 905, 906]
    ] + ['workers.us.google.status.{}'.format(i) for i in [909, 910, 911, 995, 997, 998, 999, 600, 601, 602, 603, 604, 699]
    ] + ['workers.us.google.status.{}'.format(i) for i in [200, 700, 701]
    ] + ['workers.us.google.duplicate'] + [
    # "papi.posts.yahoo.en_ag",
    "papi.posts.yahoo.en_au",
    # "papi.posts.yahoo.en_be",
    # "papi.posts.yahoo.en_bk",
    # "papi.posts.yahoo.en_bs",
    # "papi.posts.yahoo.en_ca",
    # "papi.posts.yahoo.en_ch",
    # "papi.posts.yahoo.en_ck",
    # "papi.posts.yahoo.en_gb",
    # "papi.posts.yahoo.en_hk",
    # "papi.posts.yahoo.en_id",
    # "papi.posts.yahoo.en_ie",
    # "papi.posts.yahoo.en_in",
    # "papi.posts.yahoo.en_mt",
    # "papi.posts.yahoo.en_my",
    # "papi.posts.yahoo.en_nz",
    # "papi.posts.yahoo.en_ph",
    # "papi.posts.yahoo.en_sg",
    # "papi.posts.yahoo.en_th",
    # "papi.posts.yahoo.en_uk",
    # "papi.posts.yahoo.en_us",
    # "papi.posts.yahoo.en_za",
    # "papi.posts.yahoo.es_ar",
    # "papi.posts.google.en_ae",
    # "papi.posts.google.en_ag",
    # "papi.posts.google.en_ai",
    # "papi.posts.google.en_as",
    # "papi.posts.google.en_au",
    # "papi.posts.google.en_be",
    # "papi.posts.google.en_bh",
    # "papi.posts.google.en_bk",
    # "papi.posts.google.en_bs",
    # "papi.posts.google.en_bz",
    # "papi.posts.google.en_ca",
    # "papi.posts.google.en_ch",
    # "papi.posts.google.en_ck",
    # "papi.posts.google.en_cy",
    # "papi.posts.google.en_dm",
    # "papi.posts.google.en_eg",
    # "papi.posts.google.en_gb",
    # "papi.posts.google.en_gh",
    # "papi.posts.google.en_gm",
    # "papi.posts.google.en_gy",
    # "papi.posts.google.en_hk",
    # "papi.posts.google.en_id",
    # "papi.posts.google.en_ie",
    # "papi.posts.google.en_il",
    # "papi.posts.google.en_in",
    # "papi.posts.google.en_je",
    # "papi.posts.google.en_jm",
    # "papi.posts.google.en_jo",
    # "papi.posts.google.en_ke",
    # "papi.posts.google.en_kw",
    # "papi.posts.google.en_lb",
    # "papi.posts.google.en_lk",
    # "papi.posts.google.en_mt",
    # "papi.posts.google.en_mu",
    # "papi.posts.google.en_mv",
    # "papi.posts.google.en_my",
    # "papi.posts.google.en_na",
    # "papi.posts.google.en_ng",
    # "papi.posts.google.en_nu",
    # "papi.posts.google.en_nz",
    # "papi.posts.google.en_om",
    # "papi.posts.google.en_ph",
    # "papi.posts.google.en_pk",
    # "papi.posts.google.en_qa",
    # "papi.posts.google.en_rw",
    # "papi.posts.google.en_sa",
    # "papi.posts.google.en_sg",
    # "papi.posts.google.en_sl",
    # "papi.posts.google.en_th",
    # "papi.posts.google.en_tt",
    # "papi.posts.google.en_tw",
    # "papi.posts.google.en_ua",
    # "papi.posts.google.en_ug",
    "papi.posts.google.en_uk",
    "papi.posts.google.en_us",
    # "papi.posts.google.en_vc",
    # "papi.posts.google.en_vi",
    # "papi.posts.google.en_vn",
    # "papi.posts.google.en_vu",
    # "papi.posts.google.en_ws",
    # "papi.posts.google.en_za",
    # "papi.posts.google.en_zm",
    # "papi.posts.google.en_zw",
    "papi.baidu.blocked",
    "papi.baidu.hard_blocked",
    "papi.baidu.network",
    "papi.baidu.pool",
    "papi.baidu.post.delayed",
    "papi.baidu.post.priority",
    "papi.bing.blocked",
    "papi.bing.failed_query_operator",
    "papi.bing.hard_blocked",
    "papi.bing.network",
    "papi.bing.pool",
    "papi.bing.post.delayed",
    "papi.bing.post.delayed.geo",
    "papi.bing.post.priority",
    "papi.bing.post.priority.geo",
    "papi.gmaps.blocked",
    "papi.gmaps.hard_blocked",
    "papi.gmaps.network",
    "papi.gmaps.pool",
    "papi.google.blocked",
    "papi.google.failed_query_operator",
    "papi.google.hard_blocked",
    "papi.google.network",
    "papi.google.pool",
    "papi.google.post.delayed",
    "papi.google.post.delayed.geo",
    "papi.google.post.priority",
    "papi.google.post.priority.geo",
    "papi.hourly.posts",
    "papi.post.web_insight",
    # "papi.posts.100.bing",
    # "papi.posts.100.google",
    # "papi.posts.104.google",
    # "papi.posts.116.google",
    # "papi.posts.119.bing",
    # "papi.posts.119.google",
    # "papi.posts.128.google",
    # "papi.posts.137.google",
    # "papi.posts.140.google",
    # "papi.posts.140.yahoo",
    # "papi.posts.141.bing",
    # "papi.posts.141.google",
    # "papi.posts.141.yahoo",
    # "papi.posts.145.google",
    # "papi.posts.147.baidu",
    # "papi.posts.147.bing",
    # "papi.posts.147.google",
    # "papi.posts.149.google",
    # "papi.posts.151.google",
    # "papi.posts.154.google",
    # "papi.posts.155.google",
    # "papi.posts.166.baidu",
    # "papi.posts.166.google",
    # "papi.posts.166.yahoo",
    # "papi.posts.166.yandex",
    # "papi.posts.168.bing",
    # "papi.posts.168.google",
    # "papi.posts.173.google",
    # "papi.posts.183.google",
    # "papi.posts.191.google",
    # "papi.posts.192.google",
    # "papi.posts.193.google",
    # "papi.posts.198.google",
    # "papi.posts.201.bing",
    # "papi.posts.201.google",
    # "papi.posts.201.yahoo",
    # "papi.posts.210.google",
    # "papi.posts.218.google",
    # "papi.posts.22.bing",
    # "papi.posts.230.google",
    # "papi.posts.231.bing",
    # "papi.posts.231.google",
    # "papi.posts.231.yahoo",
    # "papi.posts.233.google",
    # "papi.posts.242.google",
    # "papi.posts.247.bing",
    # "papi.posts.247.google",
    # "papi.posts.247.yahoo",
    # "papi.posts.254.google",
    # "papi.posts.257.google",
    # "papi.posts.258.google",
    # "papi.posts.258.yandex",
    # "papi.posts.261.bing",
    # "papi.posts.263.google",
    # "papi.posts.266.google",
    # "papi.posts.267.bing",
    # "papi.posts.267.google",
    # "papi.posts.267.yahoo",
    # "papi.posts.269.bing",
    # "papi.posts.269.google",
    # "papi.posts.269.yahoo",
    # "papi.posts.276.bing",
    # "papi.posts.276.google",
    # "papi.posts.276.yahoo",
    # "papi.posts.280.google",
    # "papi.posts.286.baidu",
    # "papi.posts.286.bing",
    # "papi.posts.286.google",
    # "papi.posts.286.yahoo",
    # "papi.posts.286.yandex",
    # "papi.posts.287.bing",
    # "papi.posts.287.google",
    # "papi.posts.287.yahoo",
    # "papi.posts.302.google",
    # "papi.posts.302.yahoo",
    # "papi.posts.309.google",
    # "papi.posts.313.bing",
    # "papi.posts.313.google",
    # "papi.posts.314.google",
    # "papi.posts.320.google",
    # "papi.posts.324.google",
    # "papi.posts.325.bing",
    # "papi.posts.325.google",
    # "papi.posts.325.yahoo",
    # "papi.posts.328.bing",
    # "papi.posts.328.google",
    # "papi.posts.328.yahoo",
    # "papi.posts.330.bing",
    # "papi.posts.330.google",
    # "papi.posts.330.yahoo",
    # "papi.posts.333.google",
    # "papi.posts.334.bing",
    # "papi.posts.334.google",
    # "papi.posts.334.google.com",
    # "papi.posts.337.google",
    # "papi.posts.34.bing",
    # "papi.posts.34.google",
    # "papi.posts.34.yahoo",
    # "papi.posts.343.bing",
    # "papi.posts.343.google",
    # "papi.posts.343.yahoo",
    # "papi.posts.344.google",
    # "papi.posts.348.bing",
    # "papi.posts.348.google",
    # "papi.posts.348.yahoo",
    # "papi.posts.350.google",
    # "papi.posts.351.google",
    # "papi.posts.358.google",
    # "papi.posts.362.baidu",
    # "papi.posts.362.bing",
    # "papi.posts.362.google",
    # "papi.posts.362.yahoo",
    # "papi.posts.362.yandex",
    # "papi.posts.363.google",
    # "papi.posts.364.google",
    # "papi.posts.366.google",
    # "papi.posts.367.google",
    # "papi.posts.370.google",
    # "papi.posts.372.google",
    # "papi.posts.372.yahoo",
    # "papi.posts.375.bing",
    # "papi.posts.375.google",
    # "papi.posts.384.google",
    # "papi.posts.386.google",
    # "papi.posts.391.google",
    # "papi.posts.392.google",
    "papi.posts.4.baidu",
    "papi.posts.4.bing",
    "papi.posts.4.google",
    "papi.posts.4.yahoo",
    "papi.posts.4.yandex",
    # "papi.posts.403.google",
    # "papi.posts.407.bing",
    # "papi.posts.407.google",
    # "papi.posts.412.baidu",
    # "papi.posts.412.bing",
    # "papi.posts.412.google",
    # "papi.posts.412.yahoo",
    # "papi.posts.412.yandex",
    # "papi.posts.414.google",
    # "papi.posts.419.google",
    # "papi.posts.42.bing",
    # "papi.posts.42.google",
    # "papi.posts.42.yahoo",
    # "papi.posts.420.google",
    # "papi.posts.421.google",
    # "papi.posts.422.bing",
    # "papi.posts.422.google",
    # "papi.posts.424.google",
    # "papi.posts.425.google",
    # "papi.posts.426.google",
    # "papi.posts.428.bing",
    # "papi.posts.428.google",
    # "papi.posts.428.yahoo",
    # "papi.posts.430.bing",
    # "papi.posts.430.google",
    # "papi.posts.45.baidu",
    # "papi.posts.45.bing",
    # "papi.posts.45.google",
    # "papi.posts.45.yahoo",
    # "papi.posts.45.yandex",
    # "papi.posts.50.google",
    # "papi.posts.6.google",
    # "papi.posts.64.google",
    # "papi.posts.7.google",
    # "papi.posts.70.google",
    # "papi.posts.72.google",
    # "papi.posts.79.bing",
    # "papi.posts.79.google",
    # "papi.posts.79.yahoo",
    # "papi.posts.80.bing",
    # "papi.posts.80.google",
    # "papi.posts.80.yahoo",
    # "papi.posts.83.google",
    # "papi.posts.92.bing",
    # "papi.posts.92.google",
    # "papi.posts.92.yahoo",
    # "mongodb.asserts.msgps",
    # "mongodb.asserts.regularps",
    # "mongodb.asserts.rolloversps",
    # "mongodb.asserts.userps",
    "mongodb.asserts.warningps",
    "mongodb.connections.available",
    "mongodb.connections.current",
    "mongodb.cursors.timedout",
    "mongodb.cursors.totalopen",
    "mongodb.extra_info.page_faultsps",
    # "mongodb.globallock.currentqueue.readers",
    "mongodb.globallock.currentqueue.total",
    # "mongodb.globallock.currentqueue.writers",
    "mongodb.globallock.totaltime",
    # "mongodb.mem.mapped",
    # "mongodb.mem.resident",
    "mongodb.mem.virtual",
    # "mongodb.metrics.document.deletedps",
    # "mongodb.metrics.document.insertedps",
    # "mongodb.metrics.document.returnedps",
    # "mongodb.metrics.document.updatedps",
    # "mongodb.metrics.getlasterror.wtime.numps",
    # "mongodb.metrics.getlasterror.wtime.totalmillisps",
    # "mongodb.metrics.getlasterror.wtimeoutsps",
    # "mongodb.metrics.operation.fastmodps",
    # "mongodb.metrics.operation.idhackps",
    # "mongodb.metrics.operation.scanandorderps",
    # "mongodb.metrics.queryexecutor.scannedps",
    # "mongodb.metrics.record.movesps",
    # "mongodb.metrics.repl.apply.batches.numps",
    # "mongodb.metrics.repl.apply.batches.totalmillisps",
    # "mongodb.metrics.repl.apply.opsps",
    # "mongodb.metrics.repl.buffer.count",
    # "mongodb.metrics.repl.buffer.maxsizebytes",
    # "mongodb.metrics.repl.buffer.sizebytes",
    # "mongodb.metrics.repl.network.bytesps",
    # "mongodb.metrics.repl.network.getmores.numps",
    # "mongodb.metrics.repl.network.getmores.totalmillisps",
    # "mongodb.metrics.repl.network.opsps",
    # "mongodb.metrics.repl.network.readerscreatedps",
    # "mongodb.metrics.ttl.deleteddocumentsps",
    # "mongodb.metrics.ttl.passesps",
    # "mongodb.opcounters.commandps",
    # "mongodb.opcounters.deleteps",
    # "mongodb.opcounters.getmoreps",
    # "mongodb.opcounters.insertps",
    # "mongodb.opcounters.queryps",
    # "mongodb.opcounters.updateps",
    # "mongodb.opcountersrepl.commandps",
    # "mongodb.opcountersrepl.deleteps",
    # "mongodb.opcountersrepl.getmoreps",
    # "mongodb.opcountersrepl.insertps",
    # "mongodb.opcountersrepl.queryps",
    # "mongodb.opcountersrepl.updateps",
    # "mongodb.replset.health",
    # "mongodb.replset.replicationlag",
    # "mongodb.replset.state",
    # "mongodb.stats.datasize",
    # "mongodb.stats.indexes",
    # "mongodb.stats.indexsize",
    # "mongodb.stats.objects",
    # "mongodb.stats.storagesize",
    # "mongodb.uptime",
    "mysql.innodb.buffer_pool_dirty",
    "mysql.innodb.buffer_pool_free",
    "mysql.innodb.buffer_pool_read_requests",
    # "mysql.innodb.buffer_pool_reads",
    # "mysql.innodb.buffer_pool_total",
    "mysql.innodb.buffer_pool_used",
    "mysql.innodb.buffer_pool_utilization",
    "mysql.innodb.data_reads",
    "mysql.innodb.data_writes",
    "mysql.innodb.mutex_os_waits",
    # "mysql.innodb.mutex_spin_rounds",
    # "mysql.innodb.mutex_spin_waits",
    # "mysql.innodb.os_log_fsyncs",
    "mysql.innodb.row_lock_current_waits",
    "mysql.innodb.row_lock_time",
    "mysql.innodb.row_lock_waits",
    "mysql.myisam.key_buffer_bytes_unflushed",
    "mysql.myisam.key_buffer_bytes_used",
    "mysql.myisam.key_buffer_size",
    "mysql.myisam.key_read_requests",
    # "mysql.myisam.key_reads",
    "mysql.myisam.key_write_requests",
    "mysql.myisam.key_writes",
    # "mysql.net.aborted_clients",
    # "mysql.net.aborted_connects",
    # "mysql.net.connections",
    # "mysql.net.max_connections",
    # "mysql.net.max_connections_available",
    "mysql.performance.bytes_received",
    "mysql.performance.bytes_sent",
    # "mysql.performance.com_delete",
    # "mysql.performance.com_delete_multi",
    # "mysql.performance.com_insert",
    # "mysql.performance.com_insert_select",
    "mysql.performance.com_load",
    # "mysql.performance.com_replace",
    # "mysql.performance.com_replace_select",
    # "mysql.performance.com_select",
    # "mysql.performance.com_update",
    # "mysql.performance.com_update_multi",
    # "mysql.performance.cpu_time",
    # "mysql.performance.created_tmp_disk_tables",
    # "mysql.performance.created_tmp_files",
    # "mysql.performance.created_tmp_tables",
    # "mysql.performance.kernel_time",
    # "mysql.performance.key_cache_utilization",
    "mysql.performance.open_files",
    "mysql.performance.open_tables",
    # "mysql.performance.qcache.utilization",
    # "mysql.performance.qcache.utilization.instant",
    # "mysql.performance.qcache_hits",
    # "mysql.performance.qcache_inserts",
    # "mysql.performance.qcache_lowmem_prunes",
    # "mysql.performance.qcache_size",
    # "mysql.performance.queries",
    # "mysql.performance.questions",
    # "mysql.performance.slow_queries",
    # "mysql.performance.table_locks_waited",
    # "mysql.performance.table_locks_waited.rate",
    # "mysql.performance.table_open_cache",
    # "mysql.performance.thread_cache_size",
    # "mysql.performance.threads_connected",
    # "mysql.performance.threads_running",
    "mysql.performance.user_time",
    ]

#.{}'.format(i) for i in [909, 910, 911, 995, 997, 998, 999, 600, 601, 602, 603, 604, 699]]


# anomaly queries with fixed thresholds provided as initial training set by Chase
queries = [
    {
      'name': 'sum:ex_workers.crawler_nodes.bing{*}.as_count()',
      'threshold': 10,
      'threshold_polarity': -1,
      'query': 'sum:ex_workers.crawler_nodes.bing{*}.as_count()',
    },
    {
      'name': 'max:redis.net.clients{host:proper.redis.seattle.1.ala.bs}',
      'threshold': 11350.0,
      'threshold_polarity': 1,
      'query': 'max:redis.net.clients{host:proper.redis.seattle.1.ala.bs}',
    },
    {
      'name': 'max:papi.queue.web_insight{*}',
      'threshold': 110000.0,
      'threshold_polarity': 1,
      'query': 'max:papi.queue.web_insight{*}',
    },
    {
      'name': 'max:proper.redis.requeue.standard.google{*}',
      'threshold': 2000.0,
      'threshold_polarity': 1,
      'query': 'max:proper.redis.requeue.standard.google{*}',
    },
    {
      'name': 'workers.us.google.status.901+workers.us.google.s',
      'threshold': 2.0,
      'threshold_polarity': 1,
      'query': '( ( sum:workers.us.google.status.901{*}.as_count() + sum:workers.us.google.status.902{*}.as_count() + sum:workers.us.google.status.903{*}.as_count() + sum:workers.us.google.status.904{*}.as_count() + sum:workers.us.google.status.905{*}.as_count() + sum:workers.us.google.status.906{*}.as_count() + sum:workers.us.google.status.910{*}.as_count() + sum:workers.us.google.status.911{*}.as_count() + sum:workers.us.google.status.995{*}.as_count() + sum:workers.us.google.status.997{*}.as_count() + sum:workers.us.google.status.998{*}.as_count() + sum:workers.us.google.status.999{*}.as_count() + sum:workers.us.google.status.909{*}.as_count() + sum:workers.us.google.status.600{*}.as_count() + sum:workers.us.google.status.601{*}.as_count() + sum:workers.us.google.status.602{*}.as_count() + sum:workers.us.google.status.603{*}.as_count() + sum:workers.us.google.status.604{*}.as_count() + sum:workers.us.google.status.699{*}.as_count() ) / ( sum:workers.us.google.status.200{*}.as_count() + sum:workers.us.google.status.700{*}.as_count() + sum:workers.us.google.status.701{*}.as_count() + sum:workers.us.google.duplicate{*}.as_count() + sum:workers.us.google.status.901{*}.as_count() + sum:workers.us.google.status.902{*}.as_count() + sum:workers.us.google.status.903{*}.as_count() + sum:workers.us.google.status.904{*}.as_count() + sum:workers.us.google.status.905{*}.as_count() + sum:workers.us.google.status.906{*}.as_count() + sum:workers.us.google.status.910{*}.as_count() + sum:workers.us.google.status.911{*}.as_count() + sum:workers.us.google.status.995{*}.as_count() + sum:workers.us.google.status.997{*}.as_count() + sum:workers.us.google.status.998{*}.as_count() + sum:workers.us.google.status.999{*}.as_count() + sum:workers.us.google.status.909{*}.as_count() + sum:workers.us.google.status.600{*}.as_count() + sum:workers.us.google.status.601{*}.as_count() + sum:workers.us.google.status.602{*}.as_count() + sum:workers.us.google.status.603{*}.as_count() + sum:workers.us.google.status.604{*}.as_count() + sum:workers.us.google.status.699{*}.as_count() ) ) * 100',
    },
    ]